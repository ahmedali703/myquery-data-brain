  CREATE TABLE "DASHBOARDS" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"NAME" VARCHAR2(1000 CHAR) NOT NULL ENABLE, 
	"DESCRIPTION" VARCHAR2(4000 CHAR), 
	"OWNER_USER_ID" VARCHAR2(100), 
	"IS_PUBLIC" CHAR(1) DEFAULT 'N', 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	 CHECK (IS_PUBLIC IN ('Y','N')) ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  CREATE INDEX "IDX_DASHBOARDS_OWNER" ON "DASHBOARDS" ("OWNER_USER_ID") 
  ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "DASHBOARDS_BIU" 
BEFORE UPDATE ON DASHBOARDS
FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/
ALTER TRIGGER "DASHBOARDS_BIU" ENABLE;

  CREATE TABLE "DASHBOARD_FILTERS" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"DASHBOARD_ID" NUMBER NOT NULL ENABLE, 
	"NAME" VARCHAR2(100 CHAR) NOT NULL ENABLE, 
	"KEY" VARCHAR2(100 CHAR) NOT NULL ENABLE, 
	"TYPE" VARCHAR2(30 CHAR) NOT NULL ENABLE, 
	"DEFAULT_VALUE" VARCHAR2(4000 CHAR), 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  ALTER TABLE "DASHBOARD_FILTERS" ADD FOREIGN KEY ("DASHBOARD_ID")
	  REFERENCES "DASHBOARDS" ("ID") ON DELETE CASCADE ENABLE;

  CREATE INDEX "IDX_FILTERS_DASHBOARD_ID" ON "DASHBOARD_FILTERS" ("DASHBOARD_ID") 
  ;

    CREATE TABLE "DASHBOARD_SHARES" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"DASHBOARD_ID" NUMBER NOT NULL ENABLE, 
	"USER_ID" NUMBER, 
	"ACCESS_LEVEL" VARCHAR2(20 CHAR) NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	 CHECK (ACCESS_LEVEL IN ('VIEW','EDIT')) ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  ALTER TABLE "DASHBOARD_SHARES" ADD FOREIGN KEY ("DASHBOARD_ID")
	  REFERENCES "DASHBOARDS" ("ID") ON DELETE CASCADE ENABLE;

  CREATE INDEX "IDX_SHARES_USER_ID" ON "DASHBOARD_SHARES" ("USER_ID") 
  ;

  CREATE INDEX "IDX_SHARES_DASHBOARD_ID" ON "DASHBOARD_SHARES" ("DASHBOARD_ID") 
  ;

    CREATE TABLE "DASHBOARD_VERSIONS" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"DASHBOARD_ID" NUMBER NOT NULL ENABLE, 
	"VERSION_NO" NUMBER NOT NULL ENABLE, 
	"SNAPSHOT" CLOB NOT NULL ENABLE, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  ALTER TABLE "DASHBOARD_VERSIONS" ADD FOREIGN KEY ("DASHBOARD_ID")
	  REFERENCES "DASHBOARDS" ("ID") ON DELETE CASCADE ENABLE;

        CREATE TABLE "SEND_REPORT_MAIL_LOG" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"TS" TIMESTAMP (6) DEFAULT systimestamp NOT NULL ENABLE, 
	"STEP" VARCHAR2(60), 
	"TO_ADDR" VARCHAR2(1000), 
	"SUBJ" VARCHAR2(1000), 
	"MAIL_ID" NUMBER, 
	"INFO" VARCHAR2(4000), 
	"HTML_LEN" NUMBER, 
	"ERR_STACK" CLOB, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  CREATE INDEX "IX_SEND_REPORT_MAIL_LOG_MID" ON "SEND_REPORT_MAIL_LOG" ("MAIL_ID") 
  ;


    CREATE TABLE "SMART_QUERY" 
   (	"ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"QUERY_SOURCE" CLOB, 
	"CREATED_BY" VARCHAR2(50), 
	"CREATED_DATE" DATE, 
	"CHAT_SUMMARY" CLOB, 
	"QUERY_NAME" VARCHAR2(4000), 
	 CONSTRAINT "SMART_QUERY_PK" PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

     CREATE TABLE "SYS_USERS" 
   (	"USER_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"USER_NAME" VARCHAR2(200 CHAR), 
	"USER_PASSWORD" VARCHAR2(200 CHAR), 
	"USER_ACCESS" NUMBER, 
	"USER_ADMIN" NUMBER, 
	"CREATED_DATE" DATE, 
	 CONSTRAINT "SYS_USERS_PK" PRIMARY KEY ("USER_ID")
  USING INDEX  ENABLE
   ) ;

     CREATE TABLE "WIDGETS" 
   (	"ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"DASHBOARD_ID" NUMBER NOT NULL ENABLE, 
	"TITLE" VARCHAR2(200 CHAR) NOT NULL ENABLE, 
	"SQL_QUERY" CLOB NOT NULL ENABLE, 
	"CHART_TYPE" VARCHAR2(30 CHAR) DEFAULT 'TABLE' NOT NULL ENABLE, 
	"DATA_MAPPING" CLOB, 
	"VISUAL_OPTIONS" CLOB, 
	"QUERY_PARAMS" CLOB, 
	"GRID_X" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"GRID_Y" NUMBER DEFAULT 0 NOT NULL ENABLE, 
	"GRID_W" NUMBER DEFAULT 4 NOT NULL ENABLE, 
	"GRID_H" NUMBER DEFAULT 6 NOT NULL ENABLE, 
	"REFRESH_MODE" VARCHAR2(20 CHAR) DEFAULT 'MANUAL', 
	"REFRESH_INTERVAL_SEC" NUMBER DEFAULT 0, 
	"CACHE_TTL_SEC" NUMBER DEFAULT 0, 
	"CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"UPDATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP NOT NULL ENABLE, 
	"LAST_REFRESHED_AT" TIMESTAMP (6), 
	 CHECK (REFRESH_MODE IN ('MANUAL','INTERVAL')) ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   ) ;

  ALTER TABLE "WIDGETS" ADD FOREIGN KEY ("DASHBOARD_ID")
	  REFERENCES "DASHBOARDS" ("ID") ON DELETE CASCADE ENABLE;

  CREATE INDEX "IDX_WIDGETS_DASHBOARD_ID" ON "WIDGETS" ("DASHBOARD_ID") 
  ;

  CREATE OR REPLACE EDITIONABLE TRIGGER "WIDGETS_BIU" 
BEFORE UPDATE ON WIDGETS
FOR EACH ROW
BEGIN
  :NEW.UPDATED_AT := SYSTIMESTAMP;
END;
/
ALTER TRIGGER "WIDGETS_BIU" ENABLE;
